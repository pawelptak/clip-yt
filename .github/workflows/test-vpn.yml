name: Test VPN

on:
  workflow_run:
    workflows: ["docker-push"]
    types:
      - completed
  workflow_dispatch:  # Allows manual trigger from the GitHub UI

jobs:
  deploy:
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    
    steps:
      - name: OpenVPN-Connect
      # You may pin to the exact commit or the version.
      # uses: kota65535/github-openvpn-connect-action@138eab9b8d9de7665385f1d45a93a603c2db96a0
        uses: kota65535/github-openvpn-connect-action@v3.0.0
        with:
          # Location of OpenVPN client config file
          config_file: ${{ secrets.RASPBERRY_OPENVPN_CONFIG }}
  
  
      # Verify VPN connection by pinging the server
      - name: Verify VPN Connection
        # env:
        #   RASPBERRY_SSH_HOST: ${{ secrets.RASPBERRY_SSH_HOST }}
        run: ping -c 4 192.168.1.21
          # # Username
          # username: # optional
          # # Password
          # password: # optional
          # # Pre-shared group key for TLS Auth
          # tls_auth_key: # optional
          # # Pre-shared group key for TLS Crypt
          # tls_crypt_key: # optional
          # # Per-client key for TLS Crypt V2
          # tls_crypt_v2_key: # optional
          # # Local peer's private key
          # client_key: # optional
                
