@using ClipYT.Constants;
@model VideoModel
@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
    <iframe id="videoFrame" width="420" height="315" src="" style="display: none"></iframe>
</div>

@using (Html.BeginForm("DownloadVideo", "Home", FormMethod.Post))
{
    <span>Paste url:</span> @Html.TextBoxFor(m => m.Url, new { id = "urlInput" })
    <input id="Submit" type="submit" value="submit" />
    <br />
    <span class="text-danger">@Html.ValidationMessageFor(m => m.Url)</span>
    <br />
    <span>From:</span> @Html.TextBoxFor(m => m.Start, new { placeholder = "hh:mm:ss"})
    <br />
    <span class="text-danger">@Html.ValidationMessageFor(m => m.Start)</span>
    <br />
    <span>To:</span> @Html.TextBoxFor(m => m.End, new { placeholder = "hh:mm:ss"})
    <br />
    <span class="text-danger">@Html.ValidationMessageFor(m => m.End)</span>
}


@section Scripts {
    <script>
        $(document).ready(function () {
            $("#urlInput").on('input', function () {
                if (isYoutubeUrlValid($(this).val())){
                    updateVideoFrame($(this).val());
                }
            });

            function isYoutubeUrlValid(url) {
                var regex = @Html.Raw(Json.Serialize(RegexConstants.YoutubeUrlRegex));
                return url.match(regex);
            }

            function getIdFromYoutubeUrl(url) {
                var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
                var match = url.match(regExp);
                return (match && match[7].length == 11) ? match[7] : false;
            }

            function updateVideoFrame(videoUrl) {
                var videoId = getIdFromYoutubeUrl(videoUrl);
                const embedUrl = `https://www.youtube.com/embed/${videoId}`;
                $("#videoFrame").attr("src", embedUrl);
                $("#videoFrame").show();
            }
        });
    </script>
}
